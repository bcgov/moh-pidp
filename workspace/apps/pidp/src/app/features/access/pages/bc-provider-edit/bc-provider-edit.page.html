<div class="container-box container" uiPidpInjectViewportCss>
  <app-breadcrumb [breadcrumbs]="breadcrumbsData"></app-breadcrumb>
  <div class="content-box">
    <header>
      <h1>BC Provider Account Management</h1>
      <h3>Set a new password or reset your MFA at your convenience</h3>
    </header>
    <div class="content">
      <ng-container *ngIf="showErrorCard">
        <section class="error-card" [class.show-card]="showErrorCard">
          <p>An error occurred.</p>
        </section>
      </ng-container>
      <section class="form-card">
        <div class="password-form">
          <form novalidate [formGroup]="formState.form" (ngSubmit)="onSubmit()">
            <h1><strong>Set new password</strong></h1>

            <p class="username username-intro">Provided username:</p>
            <p class="username username-overflow">{{ username }}</p>
            <div class="form-content">
              <div class="field">
                <label id="bc-provider-application-new-password"
                  >Password</label
                >
                <mat-form-field>
                  <input
                    matInput
                    formControlName="newPassword"
                    type="password"
                    aria-labelledby="bc-provider-application-new-password" />
                  <mat-error>{{ formState.getErrorMessage() }}</mat-error>
                </mat-form-field>
              </div>
              <div class="field">
                <label id="bc-provider-application-confirm-password"
                  >Confirm password</label
                >
                <mat-form-field>
                  <input
                    matInput
                    formControlName="confirmPassword"
                    type="password"
                    aria-labelledby="bc-provider-application-confirm-password"
                    [errorStateMatcher]="errorMatcher" />
                  <mat-error *ngIf="formState.form.hasError('nomatch')"
                    >Must match the new password entered above</mat-error
                  >
                </mat-form-field>
              </div>
              <div class="form-button-box">
                <button
                  mat-flat-button
                  type="submit"
                  color="primary"
                  [disabled]="!isResetButtonEnabled">
                  Reset password
                </button>
              </div>
              <app-need-help></app-need-help>
            </div>
          </form>
        </div>
      </section>
      <section class="reset-mfa">
        <div class="mfa-content">
          <h1>
            <strong>Reset your multifactor authentication (MFA)</strong>
          </h1>
          <p class="mfa-disclaimer">Only available if you login with BCSC</p>
          <div class="mfa-content-boxes">
            <div class="steps-box">
              <div class="steps-box-content">
                <img
                  src="/assets/images/icons/history.svg"
                  alt="reset-mfa-right" />
                <strong>Reset process:</strong>
                <ul>
                  <li>Unpair my devices connected to my MFA</li>
                  <li>Reconfigure my MFA by pairing my devices again</li>
                </ul>
              </div>
            </div>
            <div class="button-box">
              <div class="button-box-img">
                <img
                  ngSrc="/assets/images/mfa-hands.jpg"
                  alt="reset my MFA"
                  priority
                  fill />
              </div>
              <div class="button-box-btn">
                <button
                  class="reset-mfa-button"
                  type="button"
                  [disabled]="(identityProvider$ | async) !== IdentityProvider.BCSC"
                  (click)="onResetMfa()">
                  Reset my MFA<img
                    src="/assets/images/icons/icon-right-circle.svg"
                    alt="reset-mfa-right" />
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<ng-template #loadingDialog>
  <ui-confirm-dialog></ui-confirm-dialog>
  <mat-progress-bar *ngIf="isLoading" mode="indeterminate"></mat-progress-bar>
</ng-template>

<ng-template #resetCompleteDialog>
  <ui-confirm-dialog></ui-confirm-dialog>
  <mat-progress-bar mode="determinate" value="100"></mat-progress-bar>
</ng-template>

<ng-template #successDialog>
  <app-success-dialog
    title="Password reset completed"
    [username]="username"
    [componentType]="componentType">
  </app-success-dialog>
</ng-template>
