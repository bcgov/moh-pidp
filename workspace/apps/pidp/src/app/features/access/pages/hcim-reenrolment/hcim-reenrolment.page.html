<ui-page [busy]="busy" [form]="formState.form" (submitted)="onSubmit()">
  <ui-page-header>{{ title }}</ui-page-header>

  <ng-container *ngIf="completed; else notCompleted">
    <ui-page-section-subheader
      icon="assignment"
      heading="HCIMWeb Account Transfer">
      <ng-container uiPageSectionSubheaderDesc
        >Next Steps.</ng-container
      ></ui-page-section-subheader
    >
    <ui-alert
      type="success"
      icon="check_circle"
      iconType="outlined"
      heading="Account Transfer Successful">
      <ng-container uiAlertContent>
        <p>
          You are ready to login to HCIMWeb using your new credentials.<br />
          <button class="login-button" mat-flat-button type="button">
            <a href="hcimWebUrl" target="_blank" rel="noopener noreferrer"
              >Login to HCIMWeb</a
            >
          </button>
        </p>
      </ng-container>
    </ui-alert>
  </ng-container>

  <ng-template #notCompleted>
    <ui-page-section>
      <ui-page-section-subheader
        icon="assignment"
        heading="HCIMWeb Account Transfer">
        <ng-container uiPageSectionSubheaderDesc>
          HCIMWeb will be changing its login and authentication process with the
          following key changes:
          <ul>
            <li>
              You will no longer access HCIMWeb through the HealthNetBC Portal,
              using your HCIMWeb HealthNetBC Username and Password.
            </li>
            <li>
              Instead, you will login directly through
              <strong>
                <ui-anchor [href]="hcimWebUrl"> this link</ui-anchor> </strong
              >, using your organization credential (the same credentials used
              to access your workstation).
            </li>
          </ul>
        </ng-container>
        <p>
          <strong
            >Enter your HCIMWeb HealthNetBC Username and Password to transfer
            your current HCIMWeb HealthNetBC account credential to your
            organization credential.</strong
          >
        </p>
      </ui-page-section-subheader>
    </ui-page-section>

    <ng-container [formGroup]="formState.form">
      <ui-page-section>
        <ui-page-section-subheader heading="HCIMWeb HealthNetBC Username">
          <ng-container uiPageSectionSubheaderDesc>
            Username Format is:
            <strong>Organization ID-First Initial, Last Name.</strong><br />
            Example: 1767-bsmith
          </ng-container>
        </ui-page-section-subheader>

        <ui-alert
          *ngIf="loginAttempts > 0 && loginAttempts < maxLoginAttempts"
          type="danger"
          icon="error_outline"
          iconType="outlined"
          heading="Access Request Failed">
          <ng-container uiAlertContent>
            <p>
              If you have forgotten your password, or are unsure of it, follow
              this
              <ui-anchor [href]="healthNetBcPasswordResetUrl"> link </ui-anchor>
              to reset it before you start this process.
            </p>
            <p>
              If you are still having trouble after resetting your password,
              contact
              <ui-anchor
                scheme="mailto"
                href="hlth.registriesadmin@gov.bc.ca"></ui-anchor>
              or <ui-anchor scheme="tel" href="2509529137"></ui-anchor>.
            </p>
          </ng-container>
        </ui-alert>

        <ui-alert
          *ngIf="loginAttempts === maxLoginAttempts - 1"
          type="danger"
          icon="error_outline"
          iconType="outlined">
          <ng-container uiAlertContent>
            <p>
              You have had multiple failed login attempts the next failed
              attempt will lock your account. If you need assistance contact the
              HelpDesk at
              <ui-anchor
                scheme="mailto"
                [href]="healthNetBcHelpDeskEmail"></ui-anchor>
              or
              <ui-anchor
                scheme="tel"
                [href]="healthNetBcHelpDeskPhone"></ui-anchor
              >.
            </p>
          </ng-container>
        </ui-alert>

        <ui-alert
          *ngIf="loginAttempts >= maxLoginAttempts"
          type="danger"
          icon="error_outline"
          iconType="outlined"
          heading="Account Locked">
          <ng-container uiAlertContent>
            <p>
              You have been locked out of your account. If you need assistance
              contact the HelpDesk at
              <ui-anchor
                scheme="mailto"
                [href]="healthNetBcHelpDeskEmail"></ui-anchor>
              or
              <ui-anchor
                scheme="tel"
                [href]="healthNetBcHelpDeskPhone"></ui-anchor
              >.
            </p>
          </ng-container>
        </ui-alert>

        <div class="row">
          <div class="col-12">
            <ui-form-section [showAction]="false">
              <mat-form-field class="w-100">
                <input
                  matInput
                  placeholder="Username"
                  formControlName="ldapUsername" />
                <mat-error>Required</mat-error>
              </mat-form-field>
            </ui-form-section>
          </div>
          <ui-page-section-subheader heading="HCIMWeb HealthNetBC Password">
            <ng-container uiPageSectionSubheaderDesc>
              If you have forgotten your password, or are unsure of it, please
              follow
              <strong>
                <ui-anchor [href]="healthNetBcPasswordResetUrl">
                  this link
                </ui-anchor>
              </strong>
              to reset it before you start this process.
            </ng-container>
          </ui-page-section-subheader>
          <div class="col-12">
            <ui-form-section [showAction]="false">
              <mat-form-field class="w-100">
                <input
                  matInput
                  type="password"
                  placeholder="Password"
                  formControlName="ldapPassword" />
                <mat-error>Required</mat-error>
              </mat-form-field>
            </ui-form-section>
          </div>
        </div>
      </ui-page-section>
    </ng-container>
  </ng-template>

  <ui-page-footer>
    <button
      mat-stroked-button
      uiPageFooterAction
      type="button"
      color="primary"
      (click)="onBack()">
      Back Home
    </button>

    <ng-container *ngIf="completed; else notRequested" uiPageFooterAction>
      <button mat-flat-button type="button" color="primary" (click)="onBack()">
        Continue
      </button>
    </ng-container>

    <ng-template #notRequested>
      <button
        mat-flat-button
        uiPageFooterAction
        type="submit"
        color="primary"
        [disabled]="loginAttempts >= maxLoginAttempts">
        Next
      </button>
    </ng-template>
  </ui-page-footer>
</ui-page>
