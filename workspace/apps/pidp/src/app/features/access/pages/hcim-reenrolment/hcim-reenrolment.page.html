<ui-page [busy]="busy" [form]="formState.form" (submitted)="onSubmit()">
  <ui-page-header>{{ title }}</ui-page-header>

  <ng-container *ngIf="completed; else notCompleted">
    <ui-page-section-subheader
      icon="assignment"
      heading="HCIMWeb Account Transfer">
      <ng-container uiPageSectionSubheaderDesc>Next Steps.</ng-container>
    </ui-page-section-subheader>

    <ui-alert
      type="success"
      icon="check_circle"
      iconType="outlined"
      heading="Account Transfer Successful">
      <ng-container uiAlertContent>
        <p>You are ready to login to HCIMWeb using your new credentials.</p>
      </ng-container>
      <ng-container uiAlertActions>
        <span>
          <a mat-stroked-button uiAnchor scheme="url" [attr.href]="hcimWebUrl">
            Login to HCIMWeb
          </a>
        </span>
      </ng-container>
    </ui-alert>
  </ng-container>

  <ng-template #notCompleted>
    <ui-page-section>
      <ui-page-section-subheader
        icon="assignment"
        heading="HCIM Web Account Transfer">
        <ng-container uiPageSectionSubheaderDesc>
          You will no longer be able to access HCIM Web through the HealthNetBC
          portal with your HealthNetBC username and password.
        </ng-container>
        <p>
          Instead you will login directly using your organization's credentials
          (the same credentials used to access your workstation).
        </p>
        <p>Complete this step to transition your access.</p>
      </ui-page-section-subheader>
    </ui-page-section>

    <ng-container [formGroup]="formState.form">
      <ui-page-section>
        <ui-page-section-subheader heading="HealthNetBC Credentials">
          <ng-container uiPageSectionSubheaderDesc>
            Enter your HealthNetBC Credentials.
          </ng-container>
        </ui-page-section-subheader>

        <ui-alert
          *ngIf="loginAttempts > 0 && loginAttempts < maxLoginAttempts"
          type="danger"
          icon="error_outline"
          iconType="outlined"
          heading="Access Request Failed">
          <ng-container uiAlertContent>
            <p>
              If you have forgotten your password, or are unsure of it, follow
              this
              <ui-anchor [href]="healthNetBcPasswordResetUrl">link</ui-anchor>
              to reset it before you start this process.
            </p>
            <p>
              If you are still having trouble after resetting your password,
              contact
              <ui-anchor
                scheme="mailto"
                href="hlth.registriesadmin@gov.bc.ca"></ui-anchor>
              or <ui-anchor scheme="tel" href="2509529137"></ui-anchor>.
            </p>
          </ng-container>
        </ui-alert>

        <ui-alert
          *ngIf="loginAttempts === maxLoginAttempts - 1"
          type="danger"
          icon="error_outline"
          iconType="outlined">
          <ng-container uiAlertContent>
            <p>
              You have had multiple failed login attempts the next failed
              attempt will lock your account. If you need assistance contact the
              HelpDesk at
              <ui-anchor
                scheme="mailto"
                [href]="healthNetBcHelpDeskEmail"></ui-anchor>
              or
              <ui-anchor
                scheme="tel"
                [href]="healthNetBcHelpDeskPhone"></ui-anchor
              >.
            </p>
          </ng-container>
        </ui-alert>

        <ui-alert
          *ngIf="accessRequestStatusCode === HcimAccessRequestStatusCode.ACCOUNT_LOCKED"
          type="danger"
          icon="error_outline"
          iconType="outlined"
          heading="Account Locked">
          <ng-container uiAlertContent>
            <p>
              You have been locked out of your account. If you need assistance
              contact the HelpDesk at
              <ui-anchor
                scheme="mailto"
                [href]="healthNetBcHelpDeskEmail"></ui-anchor>
              or
              <ui-anchor
                scheme="tel"
                [href]="healthNetBcHelpDeskPhone"></ui-anchor
              >.
            </p>
          </ng-container>
        </ui-alert>

        <div class="row">
          <div class="col-12">
            <ui-form-section [showAction]="true">
              <mat-form-field class="w-100">
                <input
                  matInput
                  placeholder="HealthNetBC Username"
                  formControlName="ldapUsername" />
                <mat-error>Required</mat-error>
              </mat-form-field>
              <ng-container uiContextHelpContent>
                <strong>Username Format:</strong> 1767-bsmith (typical format of
                username: Organization ID-First Initial, Last Name)
              </ng-container>
            </ui-form-section>
          </div>
          <div class="col-12">
            <ui-form-section [showAction]="true">
              <mat-form-field class="w-100">
                <input
                  matInput
                  type="password"
                  placeholder="HealthNetBC Password"
                  formControlName="ldapPassword" />
                <mat-error>Required</mat-error>
              </mat-form-field>
              <ng-container uiContextHelpContent>
                <strong>Password:</strong> If you have forgotten your password,
                or are unsure of it, please follow this
                <ui-anchor [href]="healthNetBcPasswordResetUrl">link</ui-anchor>
                to reset it before you start this process
              </ng-container>
            </ui-form-section>
          </div>
          <div class="col-12">
            <small>
              <ui-anchor [href]="healthNetBcPasswordResetUrl">
                Have you forgotten your password?
              </ui-anchor>
            </small>
          </div>
        </div>
      </ui-page-section>
    </ng-container>
  </ng-template>

  <ui-page-footer>
    <button
      mat-stroked-button
      uiPageFooterAction
      type="button"
      color="primary"
      (click)="onBack()">
      Back Home
    </button>

    <ng-container *ngIf="completed; else notRequested" uiPageFooterAction>
      <button mat-flat-button type="button" color="primary" (click)="onBack()">
        Continue
      </button>
    </ng-container>

    <ng-template #notRequested>
      <button mat-flat-button uiPageFooterAction type="submit" color="primary">
        Next
      </button>
    </ng-template>
  </ui-page-footer>
</ui-page>
